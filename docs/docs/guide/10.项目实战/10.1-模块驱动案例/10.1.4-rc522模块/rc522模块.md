# ESP32é©±åŠ¨RC522æ¨¡å—ä¸ RFID / NFC å¡é€šä¿¡

> [!TIP] ğŸš€ ESP32é©±åŠ¨RC522å°„é¢‘ICå¡è¯†åˆ«æ¨¡å— | è½»æ¾å®ç° RFID / NFC å¡é€šä¿¡
>
> * ğŸ’¡ **ç¢ç¢å¿µ**ğŸ˜ï¼šæœ¬èŠ‚å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ ESP32 é©±åŠ¨ RC522 æ¨¡å—ï¼Œå¿«é€Ÿå®ç° RFID/NFC å¡ç‰‡çš„æ£€æµ‹å’Œè¯»å–ã€‚
> * ğŸ“º **è§†é¢‘æ•™ç¨‹**ï¼šğŸš§ *å¼€å‘ä¸­*
> * ğŸ’¾ **ç¤ºä¾‹ä»£ç **ï¼šğŸš§ *å¼€å‘ä¸­*

## ä¸€ã€ä»‹ç»

![](attachments/Pasted%20image%2020250624165127.png)

RC522 æ˜¯ä¸€æ¬¾å¸¸è§çš„ RFID è¯»å¡å™¨æ¨¡å—ï¼Œå·¥ä½œåœ¨ **13.56MHz** é¢‘æ®µï¼Œæ”¯æŒå¯¹æ ‡å‡† NFC / IC å¡ç‰‡è¿›è¡Œæ£€æµ‹å’Œé€šä¿¡ã€‚ç»“åˆ ESP32 å¯å¿«é€Ÿæ„å»ºï¼š

* é—¨ç¦æ§åˆ¶å™¨
* NFC æ ‡ç­¾æ£€æµ‹å™¨
* RFID å­¦ç”Ÿè¯ç®¡ç†å™¨
* ç®€å•çš„è€ƒå‹¤ã€ç™»å½•ã€æ”¯ä»˜ç­‰åº”ç”¨åœºæ™¯

RC522 é€šå¸¸é€šè¿‡ **SPI æ¥å£** ä¸ ESP32 é€šä¿¡ï¼Œåº“å’Œç¤ºä¾‹ä»£ç å®Œå–„ï¼Œé€‚åˆå…¥é—¨å’Œå¿«é€ŸéªŒè¯ã€‚

## äºŒã€ä½¿ç”¨

### 1ï¸âƒ£ ç¡¬ä»¶è¿æ¥

| ESP32å¼•è„š | RC522å¼•è„š | åŠŸèƒ½       |
| ------- | ------- | -------- |
| 3V3     | 3.3V    | ä¾›ç”µ       |
| GND     | GND     | åœ°çº¿       |
| GPIO18  | SCK     | SPIæ—¶é’Ÿ    |
| GPIO19  | MISO    | SPI MISO |
| GPIO23  | MOSI    | SPI MOSI |
| GPIO5   | RST     | é‡ç½®       |
| GPIO4   | SDA     | SPIç‰‡é€‰    |

### 2ï¸âƒ£ é…å¥—åº“

* ESP-IDFï¼š https://components.espressif.com/components/abobija/rc522/versions/3.3.2/versions?language=en

### 3ï¸âƒ£ é€šä¿¡æµç¨‹

1. ESP32 é€šè¿‡ SPI ä¸ RC522 é€šä¿¡ã€‚
2. æ£€æµ‹æ˜¯å¦æœ‰ RFID/NFC æ ‡ç­¾è¿›å…¥ã€‚
3. è·å– UIDã€‚
4. å¯é€‰ï¼šè¯»å–æˆ–å†™å…¥ IC å¡æ•°æ®ã€‚

## ä¸‰ã€ç¤ºä¾‹

æ¥çº¿ï¼š

``` c
#define RC522_SPI_BUS_GPIO_MISO    (25) 
#define RC522_SPI_BUS_GPIO_MOSI    (23) 
#define RC522_SPI_BUS_GPIO_SCLK    (19) 
#define RC522_SPI_SCANNER_GPIO_SDA (22) 
```

![](attachments/Pasted%20image%2020250624174733.png)

ä»£ç ï¼š

```cpp
#include <esp_log.h>
#include "rc522.h"
#include "driver/rc522_spi.h"
#include "rc522_picc.h"

static const char *TAG = "rc522-basic-example";

#define RC522_SPI_BUS_GPIO_MISO    (25) 
#define RC522_SPI_BUS_GPIO_MOSI    (23) 
#define RC522_SPI_BUS_GPIO_SCLK    (19) 
#define RC522_SPI_SCANNER_GPIO_SDA (22) 
#define RC522_SCANNER_GPIO_RST     (-1) 

static rc522_spi_config_t driver_config = {
    .host_id = SPI2_HOST,
    .bus_config = &(spi_bus_config_t){
        .miso_io_num = RC522_SPI_BUS_GPIO_MISO,
        .mosi_io_num = RC522_SPI_BUS_GPIO_MOSI,
        .sclk_io_num = RC522_SPI_BUS_GPIO_SCLK,
    },
    .dev_config = {
        .spics_io_num = RC522_SPI_SCANNER_GPIO_SDA,
    },
    .rst_io_num = RC522_SCANNER_GPIO_RST,
};

static rc522_driver_handle_t driver;
static rc522_handle_t scanner;

static void on_picc_state_changed(void *arg, esp_event_base_t base, int32_t event_id, void *data)
{
    rc522_picc_state_changed_event_t *event = (rc522_picc_state_changed_event_t *)data;
    rc522_picc_t *picc = event->picc;

    if (picc->state == RC522_PICC_STATE_ACTIVE) {
        rc522_picc_print(picc);
    }
    else if (picc->state == RC522_PICC_STATE_IDLE && event->old_state >= RC522_PICC_STATE_ACTIVE) {
        ESP_LOGI(TAG, "Card has been removed");
    }
}

void app_main()
{
    rc522_spi_create(&driver_config, &driver);
    rc522_driver_install(driver);

    rc522_config_t scanner_config = {
        .driver = driver,
    };

    rc522_create(&scanner_config, &scanner);
    rc522_register_events(scanner, RC522_EVENT_PICC_STATE_CHANGED, on_picc_state_changed, NULL);
    rc522_start(scanner);
}

```

æ•ˆæœï¼š

![](attachments/Pasted%20image%2020250624174842.png)


### å…¶ä»–

åœ¨ä½¿ç”¨esp-idf-rc522è¿™ä¸ªåº“æ—¶ï¼Œå‘ç°é€šä¿¡å¼•è„šä¸èƒ½éšæ„é…ç½®

å¯¹äºESP32æ¥è¯´ï¼Œèƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨çš„é…ç½®å¦‚ä¸‹ï¼š

```
#define RC522_SPI_BUS_GPIO_MISO    (25) 
#define RC522_SPI_BUS_GPIO_MOSI    (23) 
#define RC522_SPI_BUS_GPIO_SCLK    (19) 
#define RC522_SPI_SCANNER_GPIO_SDA (22) 
#define RC522_SCANNER_GPIO_RST     (-1) 
```

å…·ä½“è§ï¼š https://github.com/abobija/esp-idf-rc522/issues/71