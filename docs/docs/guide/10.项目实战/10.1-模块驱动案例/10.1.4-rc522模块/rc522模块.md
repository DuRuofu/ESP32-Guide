# ESP32驱动RC522模块与 RFID / NFC 卡通信

> [!TIP] 🚀 ESP32驱动RC522射频IC卡识别模块 | 轻松实现 RFID / NFC 卡通信
>
> * 💡 **碎碎念**😎：本节将介绍如何使用 ESP32 驱动 RC522 模块，快速实现 RFID/NFC 卡片的检测和读取。
> * 📺 **视频教程**：🚧 *开发中*
> * 💾 **示例代码**：🚧 *开发中*

## 一、介绍

![](attachments/Pasted%20image%2020250624165127.png)

RC522 是一款常见的 RFID 读卡器模块，工作在 **13.56MHz** 频段，支持对标准 NFC / IC 卡片进行检测和通信。结合 ESP32 可快速构建：

* 门禁控制器
* NFC 标签检测器
* RFID 学生证管理器
* 简单的考勤、登录、支付等应用场景

RC522 通常通过 **SPI 接口** 与 ESP32 通信，库和示例代码完善，适合入门和快速验证。

## 二、使用

### 1️⃣ 硬件连接

| ESP32引脚 | RC522引脚 | 功能       |
| ------- | ------- | -------- |
| 3V3     | 3.3V    | 供电       |
| GND     | GND     | 地线       |
| GPIO18  | SCK     | SPI时钟    |
| GPIO19  | MISO    | SPI MISO |
| GPIO23  | MOSI    | SPI MOSI |
| GPIO5   | RST     | 重置       |
| GPIO4   | SDA     | SPI片选    |

### 2️⃣ 配套库

* ESP-IDF： https://components.espressif.com/components/abobija/rc522/versions/3.3.2/versions?language=en

### 3️⃣ 通信流程

1. ESP32 通过 SPI 与 RC522 通信。
2. 检测是否有 RFID/NFC 标签进入。
3. 获取 UID。
4. 可选：读取或写入 IC 卡数据。

## 三、示例

接线：

``` c
#define RC522_SPI_BUS_GPIO_MISO    (25) 
#define RC522_SPI_BUS_GPIO_MOSI    (23) 
#define RC522_SPI_BUS_GPIO_SCLK    (19) 
#define RC522_SPI_SCANNER_GPIO_SDA (22) 
```

![](attachments/Pasted%20image%2020250624174733.png)

代码：

```cpp
#include <esp_log.h>
#include "rc522.h"
#include "driver/rc522_spi.h"
#include "rc522_picc.h"

static const char *TAG = "rc522-basic-example";

#define RC522_SPI_BUS_GPIO_MISO    (25) 
#define RC522_SPI_BUS_GPIO_MOSI    (23) 
#define RC522_SPI_BUS_GPIO_SCLK    (19) 
#define RC522_SPI_SCANNER_GPIO_SDA (22) 
#define RC522_SCANNER_GPIO_RST     (-1) 

static rc522_spi_config_t driver_config = {
    .host_id = SPI2_HOST,
    .bus_config = &(spi_bus_config_t){
        .miso_io_num = RC522_SPI_BUS_GPIO_MISO,
        .mosi_io_num = RC522_SPI_BUS_GPIO_MOSI,
        .sclk_io_num = RC522_SPI_BUS_GPIO_SCLK,
    },
    .dev_config = {
        .spics_io_num = RC522_SPI_SCANNER_GPIO_SDA,
    },
    .rst_io_num = RC522_SCANNER_GPIO_RST,
};

static rc522_driver_handle_t driver;
static rc522_handle_t scanner;

static void on_picc_state_changed(void *arg, esp_event_base_t base, int32_t event_id, void *data)
{
    rc522_picc_state_changed_event_t *event = (rc522_picc_state_changed_event_t *)data;
    rc522_picc_t *picc = event->picc;

    if (picc->state == RC522_PICC_STATE_ACTIVE) {
        rc522_picc_print(picc);
    }
    else if (picc->state == RC522_PICC_STATE_IDLE && event->old_state >= RC522_PICC_STATE_ACTIVE) {
        ESP_LOGI(TAG, "Card has been removed");
    }
}

void app_main()
{
    rc522_spi_create(&driver_config, &driver);
    rc522_driver_install(driver);

    rc522_config_t scanner_config = {
        .driver = driver,
    };

    rc522_create(&scanner_config, &scanner);
    rc522_register_events(scanner, RC522_EVENT_PICC_STATE_CHANGED, on_picc_state_changed, NULL);
    rc522_start(scanner);
}

```

效果：

![](attachments/Pasted%20image%2020250624174842.png)


### 其他

在使用esp-idf-rc522这个库时，发现通信引脚不能随意配置

对于ESP32来说，能够正常使用的配置如下：

```
#define RC522_SPI_BUS_GPIO_MISO    (25) 
#define RC522_SPI_BUS_GPIO_MOSI    (23) 
#define RC522_SPI_BUS_GPIO_SCLK    (19) 
#define RC522_SPI_SCANNER_GPIO_SDA (22) 
#define RC522_SCANNER_GPIO_RST     (-1) 
```

具体见： https://github.com/abobija/esp-idf-rc522/issues/71