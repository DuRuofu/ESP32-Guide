
# ESP32é©±åŠ¨28BYJ-48æ­¥è¿›ç”µæœº

> [!TIP] ğŸš€ ESP32 æ¨¡å—é©±åŠ¨æ¡ˆä¾‹ | è½»æ¾é©±åŠ¨28BYJ-48æ­¥è¿›ç”µæœº
> - ğŸ’¡ **ç¢ç¢å¿µ**ğŸ˜ï¼šæœ¬èŠ‚å°†ä»‹ç»ESP-IDFç¯å¢ƒä¸‹é©±åŠ¨28BYJ-48æ­¥è¿›ç”µæœºçš„åŸç†å’Œç›¸å…³ä»£ç ç¼–å†™ã€‚
> - ğŸ“º **è§†é¢‘æ•™ç¨‹**ï¼šğŸš§ *å¼€å‘ä¸­*  
> - ğŸ’¾ **ç¤ºä¾‹ä»£ç **ï¼š[ESP32-Guide/code/10.practice/common_modules/28byj-48](https://github.com/DuRuofu/ESP32-Guide/tree/main/code/10.practice/common_modules/28byj-48)


## ä¸€ã€ä»‹ç»

### 1.1 28BYJ-48 ç®€ä»‹

28BYJ-48 æ˜¯ä¸€æ¬¾éå¸¸å¸¸è§çš„å››ç›¸äº”çº¿å¼å•ææ€§æ­¥è¿›ç”µæœºï¼Œå¹¿æ³›åº”ç”¨äºè‡ªåŠ¨åŒ–ã€DIYã€ç©å…·å’Œä»ªå™¨ä¸­ï¼Œå› å…¶ ç»“æ„ç®€å•ã€ä»·æ ¼ä½å»‰ã€æ§åˆ¶æ–¹ä¾¿è€Œè¢«å¹¿å¤§ç”µå­çˆ±å¥½è€…å–œçˆ±ã€‚å®ƒçš„å‹å·å«ä¹‰å¦‚ä¸‹ï¼š28è¡¨ç¤ºç”µæœºç›´å¾„28æ¯«ç±³ï¼ŒBè¡¨ç¤ºæ­¥è¿›ç”µæœºï¼ŒYè¡¨ç¤ºæ°¸ç£ï¼ŒJè¡¨ç¤ºå¸¦å‡é€Ÿç®±ï¼Œ48è¡¨ç¤ºå››ç›¸å…«æ‹ã€‚
![](attachments/Pasted%20image%2020250527162100.png)
ç”µæœºå†…éƒ¨æœºæ„å¦‚ä¸‹ï¼Œä¸­é—´éƒ¨åˆ†æ˜¯è½¬å­ï¼Œç”±ä¸€ä¸ªæ°¸ç£ä½“ç»„æˆï¼Œè¾¹ä¸Šçš„æ˜¯å®šå­ç»•ç»„ã€‚
![](attachments/Pasted%20image%2020250527161829.png)

å½“å®šå­çš„ä¸€ä¸ªç»•ç»„é€šç”µæ—¶ï¼Œå°†äº§ç”Ÿä¸€ä¸ªæ–¹å‘çš„ç”µç£åœºï¼Œå¦‚æœè¿™ä¸ªç£åœºçš„æ–¹å‘å’Œè½¬å­ç£åœºæ–¹å‘ä¸åœ¨åŒä¸€æ¡ç›´çº¿ä¸Šï¼Œé‚£ä¹ˆå®šå­å’Œè½¬å­çš„ç£åœºå°†äº§ç”Ÿä¸€ä¸ªæ‰­åŠ›å°†å®šå­æ‰­è½¬ã€‚ä¾æ¬¡æ”¹å˜ç»•ç»„çš„ç£åœºï¼Œå°±å¯ä»¥ä½¿æ­¥è¿›ç”µæœºæ­£è½¬æˆ–åè½¬(æ¯”å¦‚é€šç”µæ¬¡åºä¸ºA->B->C->Dæ­£è½¬ï¼Œåä¹‹åˆ™åè½¬)ã€‚è€Œæ”¹å˜ç£åœºåˆ‡æ¢çš„æ—¶é—´é—´éš”ï¼Œå°±å¯ä»¥æ§åˆ¶æ­¥è¿›ç”µæœºçš„é€Ÿåº¦äº†ï¼Œè¿™å°±æ˜¯æ­¥è¿›ç”µæœºçš„é©±åŠ¨åŸç†ã€‚

28BYJ-48 å¯ä»¥ä½¿ç”¨ä»¥ä¸‹é©±åŠ¨æ–¹å¼ï¼š

- å•å››ç›¸ï¼ˆWave Driveï¼‰ï¼šæ¯æ¬¡åªæ¿€æ´»ä¸€ä¸ªçº¿åœˆï¼Œæœ€ä½åŠŸè€—ï¼Œä½†æ‰­çŸ©æœ€å°
- åŒå››ç›¸ï¼ˆFull Stepï¼‰ï¼šæ¯æ¬¡æ¿€æ´»ä¸¤ä¸ªçº¿åœˆï¼Œæ‰­çŸ©è¾ƒå¤§
- å…«æ‹ç»†åˆ†ï¼ˆHalf Stepï¼‰ï¼šäº¤æ›¿æ¿€æ´»å•ä¸ªå’Œä¸¤ä¸ªçº¿åœˆï¼Œè¿åŠ¨æœ€å¹³ç¨³ï¼Œç²¾åº¦æœ€é«˜ï¼ˆæ¨èï¼‰

### 1.2 ULN2003 é©±åŠ¨æ¿ä»‹ç»  

ULN2003æ˜¯ä¸€ç§æ–°å‹çš„ä¸ƒè·¯é«˜è€å‹ã€å¤§ç”µæµè¾¾æ—é¡¿æ™¶ä½“ç®¡é©±åŠ¨ICã€‚å¯ç”¨äºé©±åŠ¨ç»§ç”µå™¨ã€ç”µç£é˜€ã€æ­¥è¿›ç”µæœºç­‰ã€‚æ¯è·¯è¾“å‡ºç”µæµå¯è¾¾500mAã€‚ç”±äºå•ç‰‡æœºæ¥å£ä¿¡å·ä¸å¤Ÿå¤§éœ€è¦é€šè¿‡ ULN2003 æ”¾å¤§å†è¿æ¥åˆ°ç›¸åº”çš„ç”µæœºæ¥å£:

ä¸‹é¢æ˜¯æœ¬æ–‡ä½¿ç”¨çš„æ­¥è¿›ç”µæœºé©±åŠ¨æ¿ï¼š

![](attachments/Pasted%20image%2020250527163637.png)

å…¶ä¸­IN1-4å¼•è„šä¸ºULN2003çš„æ§åˆ¶ç«¯ï¼Œä¸»è¦è¿æ¥å•ç‰‡æœºå¼•è„šï¼Œé«˜ç”µå¹³å¯¼é€šï¼Œä½ç”µå¹³æˆªæ­¢ï¼›OUT1-4ä¸ºULN2003çš„é©±åŠ¨ç«¯ï¼Œä¸»è¦è¿æ¥æ­¥è¿›ç”µæœº4ä¸ªç›¸çº¿ã€‚LED1-4ä¸ºæŒ‡ç¤ºä½œç”¨ï¼ŒULN2003é€šé“å¯¼é€šæ—¶äº®ï¼Œæˆªæ­¢æ—¶ç­ã€‚å…·ä½“åŸç†å›¾å¦‚ä¸‹ï¼š

![](attachments/Pasted%20image%2020250527163522.png)

## äºŒã€ä½¿ç”¨

### 2.1 æ¥çº¿æ–¹å¼

| ESP32 GPIO | ULN2003 INx | è¯´æ˜     |
| ---------- | ----------- | ------ |
| GPIO 16    | IN1         | ç”µæœºAç›¸æ§åˆ¶ |
| GPIO 17    | IN2         | ç”µæœºBç›¸æ§åˆ¶ |
| GPIO 18    | IN3         | ç”µæœºCç›¸æ§åˆ¶ |
| GPIO 19    | IN4         | ç”µæœºDç›¸æ§åˆ¶ |

> æ³¨æ„ï¼šVCC/GNDï¼šè™½ç„¶ ESP32 æä¾› 5V ç”µæºè¾“å‡ºï¼Œä½†ä¸æ¨èç›´æ¥ç”¨ ESP32 æ¿è½½ 5V ç»™ç”µæœºä¾›ç”µï¼Œå»ºè®®ä½¿ç”¨å¤–éƒ¨ 5V ç”µæºï¼Œç”µæµ â‰¥500mAï¼Œé¿å…çƒ§æ¯ USB ä¾›ç”µéƒ¨åˆ†ã€‚ä½†æ˜¯GND å¿…é¡»ä¸ ESP32 å…±åœ°ã€‚ ç”µæºç”µå‹è¿‡ä½å¯èƒ½å¯¼è‡´ç”µæœºè¿è¡Œæ— åŠ›æˆ–å¤±æ­¥ã€‚

æœ€ç»ˆæ¥çº¿å¦‚ä¸‹å›¾ï¼š

![](attachments/Pasted%20image%2020250527165130.png)

### 2.2 å…·ä½“é©±åŠ¨

æ— è®ºä½¿ç”¨å“ªç§æ§åˆ¶æ¨¡å¼ï¼ˆå•å››ç›¸ã€åŒå››ç›¸ã€å…«æ‹ï¼‰ï¼Œæœ¬è´¨ä¸Šéƒ½æ˜¯æ§åˆ¶å››ä¸ªçº¿åœˆä¾æ¬¡æˆ–ç»„åˆé€šç”µï¼Œè®©ç”µæœºäº§ç”Ÿç£åœºæ¨åŠ¨è½¬å­æ—‹è½¬ã€‚åœ¨æœ¬æ¡ˆä¾‹ä¸­ï¼Œå€ŸåŠ© ULN2003 é©±åŠ¨æ¨¡å—ï¼Œæˆ‘ä»¬æ— éœ€ç›´æ¥é©±åŠ¨ç”µæµï¼Œåªéœ€è¦ç”¨ ESP32 æ§åˆ¶ 4 ä¸ª GPIO è¾“å‡ºé«˜ä½ç”µå¹³ï¼Œé©±åŠ¨ ULN2003 ä½¿å…¶å¯¼é€šç›¸åº”çº¿åœˆï¼Œå³å¯å®ç°æ­¥è¿›ç”µæœºçš„è½¬åŠ¨ã€‚

> âœ… ESP32 æ§åˆ¶ GPIO â†’ ULN2003 æ”¾å¤§ â†’ æ­¥è¿›ç”µæœºçº¿åœˆé€šç”µ â†’ è½¬å­æ—‹è½¬

## ä¸‰ã€ç¤ºä¾‹

ä¸‹é¢çš„ä»£ç å®ç°ä¸€ä¸ªç®€å•çš„å…«æ‹ç»†åˆ†çš„æ§åˆ¶é€»è¾‘ï¼š

```c
#include <stdio.h>
#include "freertos/FreeRTOS.h"
#include "freertos/task.h"
#include "driver/gpio.h"

// å®šä¹‰ GPIO å¼•è„š
#define PIN1 GPIO_NUM_16
#define PIN2 GPIO_NUM_17
#define PIN3 GPIO_NUM_18
#define PIN4 GPIO_NUM_19

// ç”µæœºæ­¥æ•°å’Œæ—‹è½¬å»¶è¿Ÿï¼ˆè¶Šå°è¶Šå¿«ï¼‰
#define STEPS_PER_REVOLUTION 4096
int rotation_speed_ms = 10; // å…¨å±€é€Ÿåº¦å˜é‡ï¼Œå•ä½ms

// åˆå§‹åŒ– GPIO
void stepper_gpio_init(void) {
    gpio_config_t io_conf = {
        .pin_bit_mask = (1ULL << PIN1) | (1ULL << PIN2) | (1ULL << PIN3) | (1ULL << PIN4),
        .mode = GPIO_MODE_OUTPUT,
        .pull_up_en = 0,
        .pull_down_en = 0,
        .intr_type = GPIO_INTR_DISABLE
    };
    gpio_config(&io_conf);
    printf("æ­¥è¿›ç”µæœº GPIO åˆå§‹åŒ–å®Œæˆ\n");
}

// å…«æ­¥åŠæ­¥æ¿€åŠ±åºåˆ—ï¼ˆåŠæ­¥é©±åŠ¨ï¼‰ï¼Œå…±8æ­¥
// é¡ºåºä¾æ¬¡æ˜¯å•ç›¸æ¿€åŠ±ä¸åŒç›¸æ¿€åŠ±äº¤æ›¿ï¼Œæå‡å¹³æ»‘åº¦
const int step_sequence[8][4] = {
    {1, 0, 0, 0}, // 1
    {1, 1, 0, 0}, // 1+2
    {0, 1, 0, 0}, // 2
    {0, 1, 1, 0}, // 2+3
    {0, 0, 1, 0}, // 3
    {0, 0, 1, 1}, // 3+4
    {0, 0, 0, 1}, // 4
    {1, 0, 0, 1}  // 4+1
};

int current_step_index = 0; // å…¨å±€æ­¥è¿›ç´¢å¼•

// è¾“å‡ºå¯¹åº”æ­¥è¿›åºåˆ—çš„ç”µå¹³
void step_motor(int step) {
    int idx = step % 8;
    gpio_set_level(PIN1, step_sequence[idx][0]);
    gpio_set_level(PIN2, step_sequence[idx][1]);
    gpio_set_level(PIN3, step_sequence[idx][2]);
    gpio_set_level(PIN4, step_sequence[idx][3]);
}

// é¡ºæ—¶é’ˆæ—‹è½¬æŒ‡å®šæ­¥æ•°
void rotate_clockwise(int steps) {
    for (int i = 0; i < steps; i++) {
        current_step_index = (current_step_index + 1) % 8;
        step_motor(current_step_index);
        vTaskDelay(pdMS_TO_TICKS(rotation_speed_ms));
    }
}

// é€†æ—¶é’ˆæ—‹è½¬æŒ‡å®šæ­¥æ•°
void rotate_counterclockwise(int steps) {
    for (int i = 0; i < steps; i++) {
        current_step_index = (current_step_index - 1 + 8) % 8;
        step_motor(current_step_index);
        vTaskDelay(pdMS_TO_TICKS(rotation_speed_ms));
    }
}

// æ—‹è½¬æŒ‡å®šè§’åº¦ï¼ˆæ­£æ•°é¡ºæ—¶é’ˆï¼Œè´Ÿæ•°é€†æ—¶é’ˆï¼‰
void rotate_angle(float degrees) {
    // ç»†åˆ†äº†ï¼Œæ­¥æ•°è¦ä¹˜ä»¥8/4=2å€
    int steps = (int)(STEPS_PER_REVOLUTION * 2 * degrees / 360.0f);
    if (steps > 0) {
        rotate_clockwise(steps);
    } else if (steps < 0) {
        rotate_counterclockwise(-steps);
    }
}

// ä¸»ä»»åŠ¡
void stepper_task(void *arg) {
    while (1) {
        printf("é¡ºæ—¶é’ˆæ—‹è½¬ä¸€æ•´åœˆ...\n");
        rotate_clockwise(STEPS_PER_REVOLUTION * 2);  // æ³¨æ„æ­¥æ•°ä¹˜2
        vTaskDelay(pdMS_TO_TICKS(1000));

        printf("é€†æ—¶é’ˆæ—‹è½¬ä¸€æ•´åœˆ...\n");
        rotate_counterclockwise(STEPS_PER_REVOLUTION * 2);
        vTaskDelay(pdMS_TO_TICKS(1000));

        printf("é¡ºæ—¶é’ˆæ—‹è½¬25åº¦...\n");
        rotate_angle(25);
        vTaskDelay(pdMS_TO_TICKS(1000));
    }
}

// app_main å…¥å£
void app_main(void) {
    stepper_gpio_init();
    xTaskCreate(stepper_task, "stepper_task", 2048, NULL, 5, NULL);
}

```

# å‚è€ƒé“¾æ¥

1. https://www.yiboard.com/thread-1800-1-1.html


