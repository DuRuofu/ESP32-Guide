# ESP32ç½‘ç»œå…¥é—¨ - BluFié…ç½‘

> [!TIP] ğŸš€ BluFié…ç½‘ | å¿«é€Ÿå®ç°ESP32çš„WiFié…ç½‘åŠŸèƒ½  
> - ğŸ’¡ **ç¢ç¢å¿µ**ğŸ˜ï¼šæœ¬èŠ‚å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ BluFi åè®®å®Œæˆ ESP32 çš„ WiFi é…ç½‘ç¨‹åºï¼Œå¹¶è®²è§£å®˜æ–¹æä¾›çš„é…ç½‘å°ç¨‹åºç¤ºä¾‹ã€‚  
> - ğŸ“º **è§†é¢‘æ•™ç¨‹**ï¼šæš‚æ—   
> - ğŸ’¾ **ç¤ºä¾‹ç¨‹åº**ï¼š[ESP32-Guide/code/09.extra/wifi_config/blufi](https://github.com/DuRuofu/ESP32-Guide/tree/main/code/09.extra/wifi_config/blufi) 
> - ğŸ“š **å®˜æ–¹æ–‡æ¡£**ï¼š[API æŒ‡å— Â» ä½åŠŸè€—è“ç‰™Â® Â» BluFi](https://docs.espressif.com/projects/esp-idf/zh_CN/v5.3.2/esp32/api-guides/ble/blufi.html?highlight=blufi)

## ä¸€ã€ä»‹ç»

è¿™é‡Œæ¬è¿ä¸€ä¸‹å®˜æ–¹çš„ä»‹ç»ï¼š

### 1.1 BluFiæ˜¯ä»€ä¹ˆ

BluFi æ˜¯ä¸€é¡¹åŸºäºè“ç‰™é€šé“çš„ Wi-Fi ç½‘ç»œé…ç½®åŠŸèƒ½ï¼Œé€‚ç”¨äº ESP32ã€‚å®ƒé€šè¿‡å®‰å…¨åè®®å°† Wi-Fi çš„ SSIDã€å¯†ç ç­‰é…ç½®ä¿¡æ¯ä¼ è¾“åˆ° ESP32ã€‚åŸºäºè¿™äº›ä¿¡æ¯ï¼ŒESP32 å¯è¿›è€Œè¿æ¥åˆ° AP æˆ–å»ºç«‹ SoftAPã€‚

BluFi æµç¨‹çš„å…³é”®éƒ¨åˆ†åŒ…æ‹¬æ•°æ®çš„åˆ†ç‰‡ã€åŠ å¯†ä»¥åŠæ ¡éªŒå’ŒéªŒè¯ã€‚

ç”¨æˆ·å¯æŒ‰éœ€è‡ªå®šä¹‰ç”¨äºå¯¹ç§°åŠ å¯†ã€éå¯¹ç§°åŠ å¯†ä»¥åŠæ ¡éªŒçš„ç®—æ³•ã€‚æ­¤å¤„ï¼Œæˆ‘ä»¬é‡‡ç”¨ DH ç®—æ³•è¿›è¡Œå¯†é’¥åå•†ï¼Œ128-AES ç®—æ³•ç”¨äºæ•°æ®åŠ å¯†ï¼ŒCRC16 ç®—æ³•ç”¨äºæ ¡éªŒå’ŒéªŒè¯ã€‚

### 1.2 é…ç½‘æµç¨‹

BluFi é…ç½‘æµç¨‹åŒ…å«é…ç½® SoftAP å’Œé…ç½® Station ä¸¤éƒ¨åˆ†ã€‚

![](attachments/Pasted%20image%2020240403181235.png)

1. ESP32 å¼€å¯ GATT Server æ¨¡å¼ï¼Œå‘é€å¸¦æœ‰ç‰¹å®šÂ _advertising data_Â çš„å¹¿æ’­ã€‚è¯¥å¹¿æ’­ä¸å±äº BluFi Profileï¼Œå¯ä»¥æŒ‰éœ€å¯¹å…¶è¿›è¡Œè‡ªå®šä¹‰ã€‚
2. ä½¿ç”¨æ‰‹æœºåº”ç”¨ç¨‹åºæœç´¢åˆ°è¯¥å¹¿æ’­åï¼Œæ‰‹æœºå°†ä½œä¸º GATT Client è¿æ¥ ESP32ã€‚è¯¥æ­¥éª¤å¯¹å…·ä½“ä½¿ç”¨å“ªæ¬¾æ‰‹æœºåº”ç”¨ç¨‹åºå¹¶æ— ç‰¹æ®Šè¦æ±‚ã€‚
3. æˆåŠŸå»ºç«‹ GATT è¿æ¥åï¼Œæ‰‹æœºä¼šå‘ ESP32 å‘é€æ•°æ®å¸§è¿›è¡Œå¯†é’¥åå•†ï¼ˆè¯¦è§Â [BluFi ä¸­å®šä¹‰çš„å¸§æ ¼å¼](https://docs.espressif.com/projects/esp-idf/zh_CN/v5.3.2/esp32/api-guides/ble/blufi.html?highlight=blufi#frame-formats)Â ï¼‰ã€‚
4. ESP32 æ”¶åˆ°å¯†é’¥åå•†çš„æ•°æ®å¸§åï¼Œä¼šæŒ‰ç…§è‡ªå®šä¹‰çš„åå•†æ–¹æ³•è¿›è¡Œè§£æã€‚
5. æ‰‹æœºä¸ ESP32 è¿›è¡Œå¯†é’¥åå•†ã€‚åå•†è¿‡ç¨‹å¯ä½¿ç”¨ DH/RSA/ECC ç­‰åŠ å¯†ç®—æ³•ã€‚
6. åå•†ç»“æŸåï¼Œæ‰‹æœºç«¯å‘ ESP32 å‘é€æ§åˆ¶å¸§ï¼Œç”¨äºè®¾ç½®å®‰å…¨æ¨¡å¼ã€‚
7. ESP32 æ”¶åˆ°æ§åˆ¶å¸§åï¼Œä½¿ç”¨å…±äº«å¯†é’¥ä»¥åŠå®‰å…¨é…ç½®å¯¹é€šä¿¡æ•°æ®è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ã€‚
8. æ‰‹æœºå‘ ESP32 å‘é€Â [BluFi ä¸­å®šä¹‰çš„å¸§æ ¼å¼](https://docs.espressif.com/projects/esp-idf/zh_CN/v5.3.2/esp32/api-guides/ble/blufi.html?highlight=blufi#frame-formats)Â ä¸­å®šä¹‰çš„æ•°æ®å¸§ï¼ŒåŒ…æ‹¬ SSIDã€å¯†ç ç­‰ Wi-Fi é…ç½®ä¿¡æ¯ã€‚
9. æ‰‹æœºå‘ ESP32 å‘é€ Wi-Fi è¿æ¥è¯·æ±‚çš„æ§åˆ¶å¸§ã€‚ESP32 æ”¶åˆ°æ§åˆ¶å¸§åï¼Œå³é»˜è®¤æ‰‹æœºå·²å®Œæˆå¿…è¦ä¿¡æ¯çš„ä¼ è¾“ï¼Œå‡†å¤‡è¿æ¥ Wi-Fiã€‚
10. è¿æ¥åˆ° Wi-Fi åï¼ŒESP32 å‘é€ Wi-Fi è¿æ¥çŠ¶æ€æŠ¥å‘Šçš„æ§åˆ¶å¸§åˆ°æ‰‹æœºã€‚è‡³æ­¤ï¼Œé…ç½‘ç»“æŸã€‚

>1. ESP32 æ”¶åˆ°å®‰å…¨æ¨¡å¼é…ç½®çš„æ§åˆ¶å¸§åï¼Œä¼šæ ¹æ®å®šä¹‰çš„å®‰å…¨æ¨¡å¼è¿›è¡Œç›¸å…³æ“ä½œã€‚
>2. è¿›è¡Œå¯¹ç§°åŠ å¯†å’Œè§£å¯†æ—¶ï¼ŒåŠ å¯†å’Œè§£å¯†å‰åçš„æ•°æ®é•¿åº¦å¿…é¡»ä¸€è‡´ã€‚æ”¯æŒåŸåœ°åŠ å¯†å’Œè§£å¯†ã€‚

## äºŒã€å°è¯•ç¼–è¯‘ä½¿ç”¨å®˜æ–¹ç¤ºä¾‹

é¦–å…ˆæˆ‘ä»¬å…ˆè·å–å®˜æ–¹çš„[Blufi é…ç½‘ä¾‹ç¨‹](https://github.com/espressif/esp-idf/tree/master/examples/bluetooth/blufi)ï¼Œè®©åå°è¯•ç¼–è¯‘çƒ§å½•ï¼š

![](attachments/Pasted%20image%2020250222094016.png)

çƒ§å½•å®Œæˆåï¼Œä¸²å£æ‰“å°å¦‚ä¸‹ï¼š

![](attachments/Pasted%20image%2020250222094420.png)


ç„¶åå®‰è£…ä¹é‘«æä¾›çš„é…å¥— EspBlufi appï¼Œå¹¶æ‰“å¼€ Wi-Fi å’Œè“â½›ï¼Œä¸‹è½½é“¾æ¥ï¼š

- Androidï¼š[EspBlufi](https://github.com/EspressifApp/EspBlufiForAndroid/releases/tag/v1.6.3)
- IOS: [EspBlufi](https://apps.apple.com/cn/app/espblufi/id1450614082)

æ‰“å¼€å®‰è£…å¥½çš„ EspBlufi è½¯ä»¶ï¼Œåœ¨ app ç•Œâ¾¯é¢ä¸‹æ‹‰åˆ·æ–°ï¼Œå¯ä»¥çœ‹åˆ°å‘¨å›´çš„è“â½›ç‰™è®¾å¤‡ï¼Œå¦‚ä¸‹å›¾ï¼š

![350](attachments/Pasted%20image%2020250222095030.png)

ç‚¹å‡»è®¾å¤‡ï¼Œè·³è½¬åˆ°è®¾å¤‡ç•Œâ¾¯é¢ï¼š

![|350](attachments/b923f06e69497d7a7770096f041ac36.jpg)


ç‚¹å‡»è¿æ¥ï¼Œè¿æ¥æˆåŠŸåå¦‚å›¾æ‰€ç¤ºï¼š


![|350](attachments/1.jpg)

ç‚¹å‡»é…ç½‘ï¼Œè¾“å…¥Wifiè¿æ¥ä¿¡æ¯ï¼ˆåŒæ—¶è¿˜å¯ä»¥é€‰æ‹©Wifiçš„æ¨¡å¼ï¼‰ï¼š

![|350](attachments/f6f97325f4e47be9a42ee91e8de3f3e.jpg)


ç¡®å®šåï¼Œå¦‚æœè¿æ¥æˆåŠŸä¼šè¾“å‡ºè¿æ¥ä¿¡æ¯ï¼š


![|350](attachments/1111.jpg)

åŒæ—¶ESP32ä¸²å£è¾“å…¥å¦‚ä¸‹ï¼Œè¡¨ç¤ºé…ç½‘æˆåŠŸï¼š

![718](attachments/Pasted%20image%2020250222094828.png)

æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ä¹é‘«æä¾›çš„å°ç¨‹åºè¿›è¡Œé…ç½‘ï¼š

![](attachments/Pasted%20image%2020250222112359.png)


ä¸Šè¿°è¿‡ç¨‹ä¸­ä½¿ç”¨åˆ°çš„APPå’Œå°ç¨‹åºæºç éƒ½å¯ä»¥åœ¨ä¹é‘«å®˜æ–¹çš„ä»“åº“ä¸­æ‰¾åˆ°ï¼Œå¤§å®¶ä¹Ÿå¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚è¿›è¡ŒäºŒæ¬¡å¼€å‘å’Œå­¦ä¹ ã€‚
## ä¸‰ã€ç¤ºä¾‹ä»£ç è§£è¯»

### 3.1 ESP32ç«¯

ç¤ºä¾‹ç¨‹åºç›®å½•å¦‚ä¸‹ï¼š

```
â”œâ”€â”€ CMakeLists.txt
â”œâ”€â”€ main
â”‚   â”œâ”€â”€ blufi_example.h
â”‚   â”œâ”€â”€ blufi_example_main.c
â”‚   â”œâ”€â”€ blufi_init.c
â”‚   â”œâ”€â”€ blufi_security.c
â”‚   â”œâ”€â”€ CMakeLists.txt
â”‚   â””â”€â”€ Kconfig.projbuild
â”œâ”€â”€ README.md
â”œâ”€â”€ sdkconfig
â”œâ”€â”€ sdkconfig.defaults
â”œâ”€â”€ sdkconfig.defaults.esp32
â”œâ”€â”€ sdkconfig.defaults.esp32c2
â”œâ”€â”€ sdkconfig.defaults.esp32c3
â”œâ”€â”€ sdkconfig.defaults.esp32c6
â””â”€â”€ sdkconfig.defaults.esp32s3
```

æˆ‘ä»¬è¿™é‡Œä¸»è¦å…³æ³¨`blufi_example.h`ï¼Œ`blufi_example_main.c`,`blufi_init.c`,`blufi_security.c`è¿™å››ä¸ªæ–‡ä»¶ï¼š







### 3.2 APPæˆ–å°ç¨‹åºç«¯

# å‚è€ƒé“¾æ¥

1. https://github.com/espressif/esp-idf/tree/master/examples/bluetooth/blufi
2. https://www.espressif.com/sites/default/files/documentation/esp32_bluetooth_networking_user_guide_cn.pdf